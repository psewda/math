language: go
go: [1.14]

stages:
  - build
  # - test
  - deploy

jobs:
  include:
    - stage: build
      script: make build
    # - stage: test
    #   script: make test
    - stage: deploy
      script: |
        make build
        output=pie-$(cat version).$TRAVIS_BUILD_NUMBER.tar.gz
        cd $TRAVIS_BUILD_DIR/bin
        tar -zcvf $output *
        cd $TRAVIS_BUILD_DIR
